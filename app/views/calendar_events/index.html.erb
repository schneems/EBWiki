<h1>Listing Calendar Events</h1>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Start time</th>
      <th>End time</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @calendar_events.each do |calendar_event| %>
      <tr>
        <td><%= calendar_event.title %></td>
        <td><%= calendar_event.description %></td>
        <td><%= calendar_event.start_time %></td>
        <td><%= calendar_event.end_time %></td>
        <td><%= link_to 'Show', calendar_event %></td>
        <td><%= link_to 'Edit', edit_calendar_event_path(calendar_event), remote: true %></td>
        <td><%= link_to 'Destroy', calendar_event, method: :delete, data: { confirm: 'Are you sure?' }, remote: true %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br>

<%= link_to 'New Calendar event', new_calendar_event_path, remote: true %>

<div class="calendar"></div>

<script type="text/javascript">
  $('.calendar').fullCalendar({
    header: {
      left: 'prev,next today',
      center: 'title',
      right: 'month,agendaWeek,agendaDay'
    },
    selectable: true,
    selectHelper: true,
    editable: true,
    eventLimit: true,
    events: '/calendar_events.json',

    select: function(start, end) {
      $.getScript('/calendar_events/new', function() {
        $('#event_date_range').val(moment(start).format("MM/DD/YYYY HH:mm") + ' - ' + moment(end).format("MM/DD/YYYY HH:mm"))
        date_range_picker();
        $('.start_hidden').val(moment(start).format('YYYY-MM-DD HH:mm'));
        $('.end_hidden').val(moment(end).format('YYYY-MM-DD HH:mm'));
      });

      calendar.fullCalendar('unselect');
    },

    eventDrop: function(event, delta, revertFunc) {
      event_data = { 
        event: {
          id: event.id,
          start_time: event.start.format(),
          end_time: event.end.format()
        }
      };
      $.ajax({
          url: event.update_url,
          data: event_data,
          type: 'PATCH'
      });
    },
      
    // eventClick: function(event, jsEvent, view) {
    //   $.getScript(event._url, function() {
    //     $('#event_date_range').val(moment(event.start).format("MM/DD/YYYY HH:mm") + ' - ' + moment(event.end).format("MM/DD/YYYY HH:mm"))
    //     date_range_picker();
    //     $('.start_hidden').val(moment(event.start).format('YYYY-MM-DD HH:mm'));
    //     $('.end_hidden').val(moment(event.end).format('YYYY-MM-DD HH:mm'));
    //   });
    // }
  });
</script>

